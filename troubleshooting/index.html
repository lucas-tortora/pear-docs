<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-troubleshooting" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Troubleshooting | Pear Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lucas-tortora.github.io/pear-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lucas-tortora.github.io/pear-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lucas-tortora.github.io/pear-docs/troubleshooting"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Troubleshooting | Pear Docs"><meta data-rh="true" name="description" content="Pear Applications"><meta data-rh="true" property="og:description" content="Pear Applications"><link data-rh="true" rel="icon" href="/pear-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lucas-tortora.github.io/pear-docs/troubleshooting"><link data-rh="true" rel="alternate" href="https://lucas-tortora.github.io/pear-docs/troubleshooting" hreflang="en"><link data-rh="true" rel="alternate" href="https://lucas-tortora.github.io/pear-docs/troubleshooting" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Troubleshooting","item":"https://lucas-tortora.github.io/pear-docs/troubleshooting"}]}</script><link rel="stylesheet" href="/pear-docs/assets/css/styles.2f4d04e7.css">
<script src="/pear-docs/assets/js/runtime~main.f81fc2be.js" defer="defer"></script>
<script src="/pear-docs/assets/js/main.25a23557.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/pear-docs/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pear-docs/"><div class="navbar__logo"><img src="/pear-docs/img/logo.svg" alt="Lucas Tortora - Pear Docs Revamp" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/pear-docs/img/logo.svg" alt="Lucas Tortora - Pear Docs Revamp" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Lucas Tortora - Pear Docs Revamp</b></a><a class="navbar__item navbar__link" href="/pear-docs/about-pear/what-is-pear">About Pear</a><a class="navbar__item navbar__link" href="/pear-docs/getting-started/install/">Getting Started</a><a class="navbar__item navbar__link" href="/pear-docs/how-to/">How To</a><a class="navbar__item navbar__link" href="/pear-docs/tutorials/">Tutorials</a><a class="navbar__item navbar__link" href="/pear-docs/references/">References</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/lucas-tortora/pear" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pear-docs/"><span title="Pear by Holepunch" class="linkLabel_WmDU">Pear by Holepunch</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/pear-docs/about-pear/what-is-pear"><span title="About Pear" class="categoryLinkLabel_W154">About Pear</span></a><button aria-label="Expand sidebar category &#x27;About Pear&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pear-docs/getting-started/install"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/pear-docs/how-to/"><span title="How To" class="categoryLinkLabel_W154">How To</span></a><button aria-label="Expand sidebar category &#x27;How To&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/pear-docs/tutorials/"><span title="Tutorials" class="categoryLinkLabel_W154">Tutorials</span></a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/pear-docs/references/"><span title="References" class="categoryLinkLabel_W154">References</span></a><button aria-label="Expand sidebar category &#x27;References&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/pear-docs/troubleshooting"><span title="Troubleshooting" class="linkLabel_WmDU">Troubleshooting</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/pear-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Troubleshooting</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Troubleshooting</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="pear-applications">Pear Applications<a href="#pear-applications" class="hash-link" aria-label="Direct link to Pear Applications" title="Direct link to Pear Applications" translate="no">​</a></h2>
<p>The article aims to help troubleshooting confusing scenarios while developing Pear applications.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pearteardown-callback-fires-but-worker-keeps-running"><code>Pear.teardown</code> Callback Fires But Worker Keeps Running<a href="#pearteardown-callback-fires-but-worker-keeps-running" class="hash-link" aria-label="Direct link to pearteardown-callback-fires-but-worker-keeps-running" title="Direct link to pearteardown-callback-fires-but-worker-keeps-running" translate="no">​</a></h3>
<p>The <code>Pear.teardown(cb)</code> callback is triggered whenever the Pear app start to unload. If it is not exiting, then something is keeping the applications event loop running. A common cause of this is not cleaning up the <a class="" href="/pear-docs/api.md#const-pipe-pear.worker.pipe">worker pipe</a> by calling <code>pipe.end()</code> to gracefully end the writable part of the stream.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pear-cli-exits-without-running-the-application"><code>pear</code> CLI Exits Without Running the Application<a href="#pear-cli-exits-without-running-the-application" class="hash-link" aria-label="Direct link to pear-cli-exits-without-running-the-application" title="Direct link to pear-cli-exits-without-running-the-application" translate="no">​</a></h3>
<p>If after debugging an application it seems the issue is happening in the Pear platform itself, try the following steps to debug the issue:</p>
<ol>
<li class="">Run pear command with logs enabled <code>pear --log [command]</code>.</li>
<li class="">If no helpful info, run sidecar with logs <code>pear sidecar --log-level 3</code>.<br>
<!-- -->If the <code>pear sidecar</code> stops after printing <code>Closing any current Sidecar clients...</code>, then the current Pear Sidecar process is hanging. Check the next steps for forensics that might explain why, but then kill existing Pear processes.<br>
<em>Note</em> that this will close any running pear applications such as Keet.</li>
<li class="">If still no helpful info, check that there are still pear processes running via <code>ps aux | grep pear</code> or equivalent method for finding processes by name.</li>
<li class="">Finally check the crash logs in platform&#x27;s <code>current</code> directory.<!-- -->
<ul>
<li class="">For sidecar: <code>sidecar.crash.log</code></li>
<li class="">For electron: <code>electron-main.crash.log</code></li>
<li class="">For pear cli: <code>cli.crash.log</code></li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="you-get-a-error-while-lock-file--resource-temporarily-unavailable">You get a <code>Error: While lock File .. Resource temporarily unavailable</code><a href="#you-get-a-error-while-lock-file--resource-temporarily-unavailable" class="hash-link" aria-label="Direct link to you-get-a-error-while-lock-file--resource-temporarily-unavailable" title="Direct link to you-get-a-error-while-lock-file--resource-temporarily-unavailable" translate="no">​</a></h3>
<p>The Error:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Uncaught (in promise) Error: While lock file: ./pear/app-storage/by-random/.../db/LOCK: Resource temporarily unavailable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Object.onopen (pear://dev/node_modules/rocksdb-native/lib/state.js:155:27)</span><br></span></code></pre></div></div>
<p>Means the application is trying to open a RockDB instance on files currently
locked by another process. This means either:</p>
<ul>
<li class="">An application is trying to open the same storage twice.<br>
<!-- -->If using <code>Corestore</code>, it is recommended to only create only one instance and
reusing it.</li>
<li class="">There are multiple of processes running for the same application.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="joining-a-hyperswarm-topic-takes-a-long-time">Joining a Hyperswarm Topic takes a long time<a href="#joining-a-hyperswarm-topic-takes-a-long-time" class="hash-link" aria-label="Direct link to Joining a Hyperswarm Topic takes a long time" title="Direct link to Joining a Hyperswarm Topic takes a long time" translate="no">​</a></h3>
<p>There can be many reasons but here are a few common reasons:</p>
<ul>
<li class="">
<p>Random NAT networks can take longer as another node may be needed to facility the connection.</p>
</li>
<li class="">
<p>Not destroying the hyperswarm instance in the <code>Pear.teardown()</code> callback so
Hyperswarm can unannounce and clean up the DHT.<br>
<!-- -->It&#x27;s recommended to clean up the hyperswarm instance with <code>swarm.destroy()</code> before exiting the application. This prevents conflicting records in the DHT for the application&#x27;s peer which cause it take longer to join a topic.</p>
<p>Example:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">Pear</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">teardown</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> swarm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">destroy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Make sure to unregister the teardown callback if the swarm is destroyed
prematurely.</p>
</li>
<li class="">
<p>A firewall is blocking the traffic.<br>
<!-- -->Please let Holepunch know if this is the case.</p>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-bare-modules-in-pear-desktop-applications">Running Bare modules in Pear Desktop Applications<a href="#running-bare-modules-in-pear-desktop-applications" class="hash-link" aria-label="Direct link to Running Bare modules in Pear Desktop Applications" title="Direct link to Running Bare modules in Pear Desktop Applications" translate="no">​</a></h3>
<p>For now this is not possible because Pear desktop applications run in Electron which uses Node.js integration. Pear v2 will unify running Pear applications in Bare with Electron as a UI module. This way the main application will be defined as a &quot;Pear-end&quot; process that can be shared across different versions of the application such as CLI, GUI, mobile, etc.</p>
<p>Running a Bare module will give you one of the following errors:</p>
<ul>
<li class=""><code>Uncaught TypeError: require.addon is not a function</code></li>
<li class=""><code>Uncaught ReferenceError: Bare is not defined</code></li>
</ul>
<p>To support both Bare and Node.js compatible modules, import maps can be defined
so a module <code>fs</code> can be resolved to <code>bare-fs</code> on Bare and <code>fs</code> on Node.js.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;imports&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;fs&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;bare&quot;: &quot;bare-fs&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;default&quot;: &quot;fs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;fs/*&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;bare&quot;: &quot;bare-fs/*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;default&quot;: &quot;fs/*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;dependencies&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;bare-fs&quot;: &quot;^2.1.5&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>See <a href="https://github.com/holepunchto/bare-node?tab=readme-ov-file#import-maps" target="_blank" rel="noopener noreferrer" class=""><code>bare-node</code>&#x27;s &quot;Import maps&quot;</a> for more details.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="bare-applications">BAre Applications<a href="#bare-applications" class="hash-link" aria-label="Direct link to BAre Applications" title="Direct link to BAre Applications" translate="no">​</a></h2>
<p>The article aims to help troubleshooting confusing scenarios while developing Bare applications.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="missing-builtin-modules-when-running-with-bare">Missing builtin Modules when Running with Bare<a href="#missing-builtin-modules-when-running-with-bare" class="hash-link" aria-label="Direct link to Missing builtin Modules when Running with Bare" title="Direct link to Missing builtin Modules when Running with Bare" translate="no">​</a></h2>
<p>Bare is minimal by design, so does not include all of the modules provided with Node.js. Instead modules such as <code>process</code> can be imported as a Bare specific module, for example <code>bare-process</code>. For a list of Node.js builtins and their Bare replacements, check out <code>bare-node</code>&#x27;s <a href="https://github.com/holepunchto/bare-node?tab=readme-ov-file#modules" target="_blank" rel="noopener noreferrer" class="">&quot;Modules&quot; table</a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="writing-a-module-with-support-for-bare--nodejs">Writing a module with Support for Bare &amp; Node.js<a href="#writing-a-module-with-support-for-bare--nodejs" class="hash-link" aria-label="Direct link to Writing a module with Support for Bare &amp; Node.js" title="Direct link to Writing a module with Support for Bare &amp; Node.js" translate="no">​</a></h3>
<p>If writing a library that can be run in both the Bare and Node.js runtimes, import maps should be used to support both the Bare version and the Node.js version of builtin modules. Import maps only apply to the <code>package.json</code>&#x27;s package so does not modify dependencies of the module.</p>
<p>See <a href="https://github.com/holepunchto/bare-node?tab=readme-ov-file#import-maps" target="_blank" rel="noopener noreferrer" class=""><code>bare-node</code>&#x27;s &quot;Import maps&quot;</a> for more details.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-3rd-party-modules-written-for-nodejs">Running 3rd Party Modules Written for Node.js<a href="#running-3rd-party-modules-written-for-nodejs" class="hash-link" aria-label="Direct link to Running 3rd Party Modules Written for Node.js" title="Direct link to Running 3rd Party Modules Written for Node.js" translate="no">​</a></h3>
<p>To support dependencies that rely on Node.js builtins (eg. <code>fs</code>, <code>os</code>, etc), an alias can be used to point to a wrapper module to use the Bare version. For example to use <code>bare-net</code> where ever <code>net</code> is used in dependencies, install it as an alias:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm i bare-net net@npm:bare-node-net</span><br></span></code></pre></div></div>
<p>See <a class="" href="/pear-docs/nodejs-compatibility-with-bare.md#consuming-dependencies-using-npm-aliases">Consuming dependencies using NPM Aliases</a> for more info.</p>
<p>For compatibility and to support builtin globals, such as <code>process</code>, the corresponding <code>bare-*</code> module will include a <code>/global.js</code> submodule that sets the global variable to <code>global</code>. This is useful when importing modules that assume the global variable exists. It is not recommended to use global variables when writing new code as it is less flexible and a harder to upgrade piecemeal.</p>
<p>Usage of a globals submodule looks like:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">require(&#x27;bare-process/global&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;platform&#x27;, process.platform) // now prints</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="addonerror-addon_not_found-cannot-find-addon-when-running-bare"><code>AddonError: ADDON_NOT_FOUND: Cannot find addon</code> when running Bare<a href="#addonerror-addon_not_found-cannot-find-addon-when-running-bare" class="hash-link" aria-label="Direct link to addonerror-addon_not_found-cannot-find-addon-when-running-bare" title="Direct link to addonerror-addon_not_found-cannot-find-addon-when-running-bare" translate="no">​</a></h2>
<p>As the error suggests, this is because the native addon cannot be found. This could either be because the addon is missing or Bare is looking in a different place than expected.</p>
<p>A few reasons why an addon may be missing:</p>
<ul>
<li class="">
<p>The addon is not available for the current platform and/or architecture.<br>
<!-- -->To see what platform and architecture Bare is running on, log <code>Bare.platform</code> and <code>Bare.arch</code>.</p>
</li>
<li class="">
<p>The addon wasn&#x27;t linked ahead of time.<br>
<!-- -->Mobile applications require native code to be linked as part of compiling the application.</p>
<p>If developing with <code>react-native-bare-kit</code> (including using <code>bare-expo</code> as a template), check that the addon was loaded in <code>node_modules/react-native-bare-kit/ios/addons</code> for iOS and <code>node_modules/react-native-bare-kit/android/src/main/addons</code> for Android. This is where the libraries are linked from.</p>
<p>If other solutions are not working, it may be an issue with the build cache. Try clearing the cache and recompiling.</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="bare-pack-with-conditional-module-loading"><code>bare-pack</code> with conditional module loading<a href="#bare-pack-with-conditional-module-loading" class="hash-link" aria-label="Direct link to bare-pack-with-conditional-module-loading" title="Direct link to bare-pack-with-conditional-module-loading" translate="no">​</a></h2>
<p><a href="https://github.com/holepunchto/bare-pack" target="_blank" rel="noopener noreferrer" class=""><code>bare-pack</code></a> does not evaluate your code but scans for imports. This means it cannot infer dynamic imports but assumes all imports will be loaded for the target platform. For example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const { runtime } = require(&#x27;which-runtime&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let crypto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (runtime === &#x27;bare&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto = require(&#x27;bare-crypto&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto = require(&#x27;node:crypto&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Will thrown:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./node_modules/paparam/index.js:514</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new Bail(bail.reason)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bail: ModuleTraverseError: MODULE_NOT_FOUND: Cannot find module &#x27;node:crypto&#x27; imported from &#x27;file://./index.js&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at exports.imports (./node_modules/bare-module-traverse/index.js:331:24)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at exports.imports.next (&lt;anonymous&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at exports.module (./node_modules/bare-module-traverse/index.js:152:18)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at exports.module.next (&lt;anonymous&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at process (./node_modules/bare-pack/index.js:50:26)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at async pack (./node_modules/bare-pack/index.js:24:3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at async Command._runner (./node_modules/bare-pack/bin.js:46:18)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at async runAsync (./node_modules/paparam/index.js:793:5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Command._bail (./node_modules/paparam/index.js:514:11)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Command.bail (./node_modules/paparam/index.js:127:36)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at runAsync (./node_modules/paparam/index.js:795:7)</span><br></span></code></pre></div></div>
<p>This is because it is trying to pack <code>node:crypto</code> for Bare which isn&#x27;t possible.</p>
<p>Instead of dynamic conditions based on runtime environment, modules should have an import map defined to use the correct module for the given runtime.</p>
<p>See <a href="https://github.com/holepunchto/bare-node?tab=readme-ov-file#import-maps" target="_blank" rel="noopener noreferrer" class=""><code>bare-node</code>&#x27;s &quot;Import maps&quot;</a> for more details.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/troubleshooting.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/pear-docs/references/tools/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tools Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#pear-applications" class="table-of-contents__link toc-highlight">Pear Applications</a><ul><li><a href="#pearteardown-callback-fires-but-worker-keeps-running" class="table-of-contents__link toc-highlight"><code>Pear.teardown</code> Callback Fires But Worker Keeps Running</a></li><li><a href="#pear-cli-exits-without-running-the-application" class="table-of-contents__link toc-highlight"><code>pear</code> CLI Exits Without Running the Application</a></li><li><a href="#you-get-a-error-while-lock-file--resource-temporarily-unavailable" class="table-of-contents__link toc-highlight">You get a <code>Error: While lock File .. Resource temporarily unavailable</code></a></li><li><a href="#joining-a-hyperswarm-topic-takes-a-long-time" class="table-of-contents__link toc-highlight">Joining a Hyperswarm Topic takes a long time</a></li><li><a href="#running-bare-modules-in-pear-desktop-applications" class="table-of-contents__link toc-highlight">Running Bare modules in Pear Desktop Applications</a></li></ul></li><li><a href="#bare-applications" class="table-of-contents__link toc-highlight">BAre Applications</a></li><li><a href="#missing-builtin-modules-when-running-with-bare" class="table-of-contents__link toc-highlight">Missing builtin Modules when Running with Bare</a><ul><li><a href="#writing-a-module-with-support-for-bare--nodejs" class="table-of-contents__link toc-highlight">Writing a module with Support for Bare &amp; Node.js</a></li><li><a href="#running-3rd-party-modules-written-for-nodejs" class="table-of-contents__link toc-highlight">Running 3rd Party Modules Written for Node.js</a></li></ul></li><li><a href="#addonerror-addon_not_found-cannot-find-addon-when-running-bare" class="table-of-contents__link toc-highlight"><code>AddonError: ADDON_NOT_FOUND: Cannot find addon</code> when running Bare</a></li><li><a href="#bare-pack-with-conditional-module-loading" class="table-of-contents__link toc-highlight"><code>bare-pack</code> with conditional module loading</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"></div></footer></div>
</body>
</html>