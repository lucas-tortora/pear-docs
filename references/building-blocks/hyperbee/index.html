<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-references/building-blocks/hyperbee" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Hyperbee | Pear Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lucas-tortora.github.io/pear-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lucas-tortora.github.io/pear-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lucas-tortora.github.io/pear-docs/references/building-blocks/hyperbee"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Hyperbee | Pear Docs"><meta data-rh="true" name="description" content="Hyperbee is an append only B-tree based on Hypercore. It provides a key/value-store API, with methods for inserting and getting key-value pairs, atomic batch insertions, and creating sorted iterators. It uses a single Hypercore for storage, using a technique called embedded indexing. It provides features like cache warmup extension, efficient diffing, version control, sorted iteration, and sparse downloading."><meta data-rh="true" property="og:description" content="Hyperbee is an append only B-tree based on Hypercore. It provides a key/value-store API, with methods for inserting and getting key-value pairs, atomic batch insertions, and creating sorted iterators. It uses a single Hypercore for storage, using a technique called embedded indexing. It provides features like cache warmup extension, efficient diffing, version control, sorted iteration, and sparse downloading."><link data-rh="true" rel="icon" href="/pear-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lucas-tortora.github.io/pear-docs/references/building-blocks/hyperbee"><link data-rh="true" rel="alternate" href="https://lucas-tortora.github.io/pear-docs/references/building-blocks/hyperbee" hreflang="en"><link data-rh="true" rel="alternate" href="https://lucas-tortora.github.io/pear-docs/references/building-blocks/hyperbee" hreflang="x-default"><link rel="stylesheet" href="/pear-docs/assets/css/styles.4b065cb5.css">
<script src="/pear-docs/assets/js/runtime~main.b1f38c1e.js" defer="defer"></script>
<script src="/pear-docs/assets/js/main.07b94650.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/pear-docs/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pear-docs/"><div class="navbar__logo"><img src="/pear-docs/img/logo.svg" alt="Lucas Tortora - Pear Docs Revamp" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/pear-docs/img/logo.svg" alt="Lucas Tortora - Pear Docs Revamp" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Lucas Tortora - Pear Docs Revamp</b></a><a class="navbar__item navbar__link" href="/pear-docs/getting-started/install/">Getting Started</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/lucas-tortora/pear" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Hyperbee</h1></header>
<p>Hyperbee is an append only B-tree based on <a class="" href="/pear-docs/references/building-blocks/hypercore"><code>Hypercore</code></a>. It provides a key/value-store API, with methods for inserting and getting key-value pairs, atomic batch insertions, and creating sorted iterators. It uses a single Hypercore for storage, using a technique called embedded indexing. It provides features like cache warmup extension, efficient diffing, version control, sorted iteration, and sparse downloading.</p>
<blockquote>
<p>As with the Hypercore, a Hyperbee can only have a <strong>single writer on a single machine</strong>; the creator of the Hyperdrive is the only person who can modify it as they&#x27;re the only one with the private key. That said, the writer can replicate to <strong>many readers</strong>, in a manner similar to BitTorrent.</p>
</blockquote>
<blockquote>
<p><a href="https://github.com/holepunchto/hyperbee" target="_blank" rel="noopener noreferrer" class="">GitHub (Hyperbee)</a></p>
</blockquote>
<ul>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee">Hyperbee</a>:<!-- -->
<ul>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#installation">Create a new instance</a>:</li>
<li class="">Basic:<!-- -->
<ul>
<li class="">Properties:<!-- -->
<ul>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.core">db.core</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.version">db.version</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.id">db.id</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.key">db.key</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.discoverykey">db.discoveryKey</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.writable">db.writable</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.readable">db.readable</a></li>
</ul>
</li>
<li class="">Methods:<!-- -->
<ul>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.ready">db.ready()</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.close">db.close()</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.put">db.put(key, [value], [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.get">db.get(key, [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.del">db.del(key, [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.getbyseq">db.getBySeq(seq, [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.replicate">db.replicate(isInitiatorOrStream)</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.batch">db.batch()</a>
<ul>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#batch.put">batch.put(key, [value], [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#batch.get">batch.get(key, [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#batch.del">batch.del(key, [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#batch.flush">batch.flush()</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#batch.close">batch.close()</a></li>
</ul>
</li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.createreadstream">db.createReadStream([range], [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.peek">db.peek([range], [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.createhistorystream">db.createHistoryStream([options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.creatediffstream">db.createDiffStream(otherVersion, [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.getandwatch">db.getAndWatch(key, [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.watch">db.watch([range])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.checkout">db.checkout(version)</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.snapshot">db.snapshot()</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.sub">db.sub(&#x27;sub-prefix&#x27;, [options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.getheader">db.getHeader([options])</a></li>
<li class=""><a class="" href="/pear-docs/references/building-blocks/hyperbee#db.ishyperbee">Hyperbee.isHyperbee(core, [options])</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="installation">Installation<a href="#installation" class="hash-link" aria-label="Direct link to Installation" title="Direct link to Installation" translate="no">​</a></h3>
<p>Install with <a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer" class="">npm</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm install hyperbee</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="api">API<a href="#api" class="hash-link" aria-label="Direct link to API" title="Direct link to API" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="const-db--new-hyperbeecore-options"><strong><code>const db = new Hyperbee(core, [options])</code></strong><a href="#const-db--new-hyperbeecore-options" class="hash-link" aria-label="Direct link to const-db--new-hyperbeecore-options" title="Direct link to const-db--new-hyperbeecore-options" translate="no">​</a></h4>
<p>Make a new Hyperbee instance. <code>core</code> should be a <a class="" href="/pear-docs/references/building-blocks/hypercore"><code>Hypercore</code></a>.</p>
<p><code>options</code> include:</p>
<table><thead><tr><th style="text-align:center">Property</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody><tr><td style="text-align:center"><strong><code>valueEncoding</code></strong></td><td>Encoding type for the values. Takes values of &#x27;json&#x27;, &#x27;utf-8&#x27;, or &#x27;binary&#x27;.</td><td>String</td><td><code>&#x27;binary&#x27;</code></td></tr><tr><td style="text-align:center"><strong><code>keyEncoding</code></strong></td><td>Encoding type for the keys. Takes values of &#x27;ascii&#x27;, &#x27;utf-8&#x27;, or &#x27;binary&#x27;.</td><td>String</td><td><code>&#x27;binary&#x27;</code></td></tr></tbody></table>
<blockquote>
<p>Currently read/diff streams sort based on the <em>encoded</em> value of the keys.</p>
</blockquote>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="properties">Properties<a href="#properties" class="hash-link" aria-label="Direct link to Properties" title="Direct link to Properties" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.core"><strong><code>db.core</code></strong><a href="#db.core" class="hash-link" aria-label="Direct link to db.core" title="Direct link to db.core" translate="no">​</a></h4>
<p>The underlying <a class="" href="/pear-docs/references/building-blocks/hypercore">Hypercore</a> backing this bee.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.version"><strong><code>db.version</code></strong><a href="#db.version" class="hash-link" aria-label="Direct link to db.version" title="Direct link to db.version" translate="no">​</a></h4>
<p>A number that indicates how many modifications were made, is useful as a version identifier.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.id"><strong><code>db.id</code></strong><a href="#db.id" class="hash-link" aria-label="Direct link to db.id" title="Direct link to db.id" translate="no">​</a></h4>
<p>String containing the ID (z-base-32 of the public key) identifying this bee.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.key"><strong><code>db.key</code></strong><a href="#db.key" class="hash-link" aria-label="Direct link to db.key" title="Direct link to db.key" translate="no">​</a></h4>
<p>Buffer containing the public key identifying this bee.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.discoverykey"><strong><code>db.discoveryKey</code></strong><a href="#db.discoverykey" class="hash-link" aria-label="Direct link to db.discoverykey" title="Direct link to db.discoverykey" translate="no">​</a></h4>
<p>Buffer containing a key derived from <code>db.key</code>.</p>
<blockquote>
<p>This discovery key is not for verifying the data, it&#x27;s only to announce or look for peers that are sharing the same bee, without leaking the bee key.</p>
</blockquote>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.writable"><strong><code>db.writable</code></strong><a href="#db.writable" class="hash-link" aria-label="Direct link to db.writable" title="Direct link to db.writable" translate="no">​</a></h4>
<p>Boolean indicating to put or delete data in this bee.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.readable"><strong><code>db.readable</code></strong><a href="#db.readable" class="hash-link" aria-label="Direct link to db.readable" title="Direct link to db.readable" translate="no">​</a></h4>
<p>Boolean indicating if we can read from this bee. After closing the bee this will be <code>false</code>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="methods"><strong>Methods</strong><a href="#methods" class="hash-link" aria-label="Direct link to methods" title="Direct link to methods" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.ready"><strong><code>await db.ready()</code></strong><a href="#db.ready" class="hash-link" aria-label="Direct link to db.ready" title="Direct link to db.ready" translate="no">​</a></h4>
<p>Waits until the internal state is loaded.</p>
<p>Use it once before reading synchronous properties like <code>db.version</code>, unless any of the other APIs have been called first.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.close"><strong><code>await db.close()</code></strong><a href="#db.close" class="hash-link" aria-label="Direct link to db.close" title="Direct link to db.close" translate="no">​</a></h4>
<p>Fully close this bee, including its core.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.put"><strong><code>await db.put(key, [value], [options])</code></strong><a href="#db.put" class="hash-link" aria-label="Direct link to db.put" title="Direct link to db.put" translate="no">​</a></h4>
<p>Inserts a new key. Value can be optional.</p>
<blockquote>
<p>If inserting a series of data atomically or high performance is needed then check the <code>db.batch</code> API.</p>
</blockquote>
<p><strong><code>options</code></strong> includes:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">cas</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">prev</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> next</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Compare And Swap (cas)</strong></p>
<p><code>cas</code> option is a function comparator to control whether the <code>put</code> succeeds.</p>
<p>By returning <code>true</code> it will insert the value, otherwise, it won&#x27;t.</p>
<p>It receives two args: <code>prev</code> is the current node entry, and <code>next</code> is the potential new node.</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;number&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;123&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> cas </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;number&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; { seq: 1, key: &#x27;number&#x27;, value: &#x27;123&#x27; }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;number&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;123&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> cas </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;number&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; { seq: 1, key: &#x27;number&#x27;, value: &#x27;123&#x27; }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Without cas this would have been { seq: 2, ... }, and the next { seq: 3 }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;number&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;456&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> cas </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;number&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; { seq: 2, key: &#x27;number&#x27;, value: &#x27;456&#x27; }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cas</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">prev</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> next</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// can use same-data or same-object lib, depending on the value complexity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> prev</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> next</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.get"><strong><code>const { seq, key, value } = await db.get(key, [options])</code></strong><a href="#db.get" class="hash-link" aria-label="Direct link to db.get" title="Direct link to db.get" translate="no">​</a></h4>
<p>Gets a key&#x27;s value. Returns <code>null</code> if the key doesn&#x27;t exist.</p>
<p><code>seq</code> is the Hypercore index at which this key was inserted.</p>
<p><code>options</code> include:</p>
<table><thead><tr><th>Property</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody><tr><td><strong><code>wait</code></strong></td><td>Wait for the meta-data of hypercore to be updated</td><td>Boolean</td><td><code>true</code></td></tr><tr><td><strong><code>update</code></strong></td><td>Determine if the core has to be updated before any operation</td><td>Boolean</td><td><code>true</code></td></tr><tr><td><strong><code>keyEncoding</code></strong></td><td>Encoding type for the keys. Takes values of &#x27;json&#x27;, &#x27;utf-8&#x27;, or &#x27;binary&#x27;.</td><td>String</td><td><code>binary</code></td></tr><tr><td><strong><code>valueEncoding</code></strong></td><td>Encoding type for the values. Takes values of &#x27;json&#x27;, &#x27;utf-8&#x27;, or &#x27;binary&#x27;.</td><td>String</td><td><code>binary</code></td></tr></tbody></table>
<blockquote>
<p><code>db.get(key, [options])</code> uses the state at the time of initiating the read, so the write operations that complete after <code>get</code> is initiated and before it is resolved are ignored.</p>
</blockquote>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.del"><strong><code>await db.del(key, [options])</code></strong><a href="#db.del" class="hash-link" aria-label="Direct link to db.del" title="Direct link to db.del" translate="no">​</a></h4>
<p>Delete a key.</p>
<p><code>options</code> include:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">cas</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">prev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Compare And Swap (cas)</strong></p>
<p><code>cas</code> option is a function comparator to control whether the <code>del</code> succeeds.</p>
<p>By returning <code>true</code> it will delete the value, otherwise, it won&#x27;t.</p>
<p>It only receives one arg: <code>prev</code> which is the current node entry.</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// This won&#x27;t get deleted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">del</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;number&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> cas </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;number&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; { seq: 1, key: &#x27;number&#x27;, value: &#x27;value&#x27; }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Change the value so the next time we try to delete it then &quot;cas&quot; will return true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;number&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;can-be-deleted&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">del</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;number&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> cas </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;number&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cas</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">prev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> prev</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;can-be-deleted&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.getbyseq"><strong><code>const { key, value } = await db.getBySeq(seq, [options])</code></strong><a href="#db.getbyseq" class="hash-link" aria-label="Direct link to db.getbyseq" title="Direct link to db.getbyseq" translate="no">​</a></h4>
<p>Gets the key and value from a block number.</p>
<p><code>seq</code> is the Hypercore index. Returns <code>null</code> if block doesn&#x27;t exists.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.replicate"><strong><code>const stream = db.replicate(isInitiatorOrStream)</code></strong><a href="#db.replicate" class="hash-link" aria-label="Direct link to db.replicate" title="Direct link to db.replicate" translate="no">​</a></h4>
<p>See more about how replicate works at <a class="" href="/pear-docs/references/building-blocks/hypercore#const-stream-core.replicate-isinitiatororreplicationstream">core.replicate</a>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.batch"><strong><code>const batch = db.batch()</code></strong><a href="#db.batch" class="hash-link" aria-label="Direct link to db.batch" title="Direct link to db.batch" translate="no">​</a></h4>
<p>Makes a new atomic batch that is either fully processed or not processed at all.</p>
<blockquote>
<p>If there are several inserts and deletions then a batch can be much faster.</p>
</blockquote>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.put"><strong><code>await batch.put(key, [value], [options])</code></strong><a href="#db.put" class="hash-link" aria-label="Direct link to db.put" title="Direct link to db.put" translate="no">​</a></h4>
<p>Inserts a key into a batch.</p>
<p><code>options</code> are the same as <strong><code>db.put</code></strong> method.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="batch.get"><strong><code>const { seq, key, value } = await batch.get(key, [options])</code></strong><a href="#batch.get" class="hash-link" aria-label="Direct link to batch.get" title="Direct link to batch.get" translate="no">​</a></h4>
<p>Gets a key, and value out of a batch.</p>
<p><code>options</code> are the same as <strong><code>db.get</code></strong> method.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="batch.del"><strong><code>await batch.del(key, [options])</code></strong><a href="#batch.del" class="hash-link" aria-label="Direct link to batch.del" title="Direct link to batch.del" translate="no">​</a></h4>
<p>Deletes a key into the batch.</p>
<p><code>options</code> are the same as <strong><code>db.del</code></strong> method.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="batch.flush"><strong><code>await batch.flush()</code></strong><a href="#batch.flush" class="hash-link" aria-label="Direct link to batch.flush" title="Direct link to batch.flush" translate="no">​</a></h4>
<p>Commits the batch to the database, and releases any locks it has acquired.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="batch.close"><strong><code>await batch.close()</code></strong><a href="#batch.close" class="hash-link" aria-label="Direct link to batch.close" title="Direct link to batch.close" translate="no">​</a></h4>
<p>Destroys a batch, and releases any locks it has acquired on the <code>db</code>.</p>
<p>Call this to abort a batch without flushing it.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Learn more about <code>db.batch()</code></summary><div><div class="collapsibleContent_i85q"><p>A batch is atomic: it is either processed fully or not at all.</p><p>A Hyperbee has a single write lock. A batch acquires this write lock with its first modifying operation (<strong><code>put</code></strong>, <strong><code>del</code></strong>), and releases it when it flushes. We can also explicitly acquire the lock with <strong><code>await batch.lock()</code></strong>. If using the batch only for read operations, the write lock is never acquired. Once the write lock is acquired, the batch must flush before any other writes to the Hyperbee can be processed.</p><p>A batch&#x27;s state snaps at creation time, so write operations applied outside of the batch are not taken into account when reading. Write operations within the batch do get taken into account, as is to be expected — if we first run <strong><code>await batch.put(&#x27;myKey&#x27;, &#x27;newValue&#x27;)</code></strong> and later run <strong><code>await batch.get(&#x27;myKey&#x27;)</code></strong>, then  <strong><code>&#x27;newValue&#x27;</code></strong> should be observed.</p></div></div></details>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.createreadstream"><strong><code>const stream = db.createReadStream([range], [options])</code></strong><a href="#db.createreadstream" class="hash-link" aria-label="Direct link to db.createreadstream" title="Direct link to db.createreadstream" translate="no">​</a></h4>
<p>Make a read stream. Sort order is based on the binary value of the keys. All entries in the stream are similar to the ones returned from <strong><code>db.get</code></strong>.</p>
<p><code>range</code> should specify the range to read and looks like this:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">gt</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;only return keys &gt; than this&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">gte</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;only return keys &gt;= than this&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">lt</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;only return keys &lt; than this&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">lte</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;only return keys &lt;= than this&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><code>options</code> include:</p>
<table><thead><tr><th>Property</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody><tr><td><strong><code>reverse</code></strong></td><td>determine order of the keys</td><td>Boolean</td><td><code>false</code></td></tr><tr><td><strong><code>limit</code></strong></td><td>maximum number of entries needed</td><td>Integer</td><td><code>-1</code></td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.peek"><strong><code>const { seq, key, value } = await db.peek([range], [options])</code></strong><a href="#db.peek" class="hash-link" aria-label="Direct link to db.peek" title="Direct link to db.peek" translate="no">​</a></h4>
<p>Similar to doing a read stream and returning the first value, but a bit faster than that.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.createhistorystream"><strong><code>const stream = db.createHistoryStream([options])</code></strong><a href="#db.createhistorystream" class="hash-link" aria-label="Direct link to db.createhistorystream" title="Direct link to db.createhistorystream" translate="no">​</a></h4>
<p>Create a stream of all entries ever inserted or deleted from the <code>db</code>. Each entry has an additional <code>type</code> property indicating if it was a <code>put</code> or <code>del</code> operation.</p>
<p><code>options</code> include:</p>
<table><thead><tr><th>Property</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody><tr><td><strong><code>live</code></strong></td><td>determine whether the stream will wait for new data and never end or not</td><td>Boolean</td><td><code>false</code></td></tr><tr><td><strong><code>reverse</code></strong></td><td>determine the order in which data is received</td><td>Boolean</td><td><code>false</code></td></tr><tr><td><strong><code>gt</code></strong></td><td>start after this index</td><td>Integer</td><td><code>null</code></td></tr><tr><td><strong><code>gte</code></strong></td><td>start with this seq (inclusive)</td><td>Integer</td><td><code>null</code></td></tr><tr><td><strong><code>lt</code></strong></td><td>stop before this index</td><td>Integer</td><td><code>null</code></td></tr><tr><td><strong><code>lte</code></strong></td><td>stop after this index</td><td>Integer</td><td><code>null</code></td></tr><tr><td><strong><code>limit</code></strong></td><td>maximum number of entries needed</td><td>Integer</td><td><code>-1</code></td></tr></tbody></table>
<blockquote>
<p>If any of the gte, gt, lte, lt arguments are <code>&lt; 0</code> then they&#x27;ll implicitly be added with the version before starting so doing <code>{ gte: -1 }</code> makes a stream starting at the last index.</p>
</blockquote>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.creatediffstream"><strong><code>const stream = db.createDiffStream(otherVersion, [options])</code></strong><a href="#db.creatediffstream" class="hash-link" aria-label="Direct link to db.creatediffstream" title="Direct link to db.creatediffstream" translate="no">​</a></h4>
<p>Creates a stream of shallow changes between two versions of the <code>db</code>.</p>
<p><code>options</code> are the same as <code>db.createReadStream</code>, except for reverse.</p>
<p>Each entry is sorted by key and looks like this:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">left</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">the entry </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the db</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">right</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">the entry </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the other version</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<blockquote>
<p>If an entry exists in <code>db</code> but not in the other version, then <code>left</code> is set and <code>right</code> will be null, and vice versa.</p>
<p>If the entries are causally equal (i.e., they have the identical seq), they are not returned, only the diff.</p>
</blockquote>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.getandwatch"><code>const entryWatcher = await db.getAndWatch(key, [options])</code><a href="#db.getandwatch" class="hash-link" aria-label="Direct link to db.getandwatch" title="Direct link to db.getandwatch" translate="no">​</a></h4>
<p>Returns a watcher which listens to changes on the given key.</p>
<p><code>entryWatcher.node</code> contains the current entry in the same format as the result of <code>bee.get(key)</code>, and will be updated as it changes.</p>
<blockquote>
<p>By default, the node will have the bee&#x27;s key encoding and value encoding, but it can be overwritten by setting the <code>keyEncoding</code> and <code>valueEncoding</code> options.</p>
<p>Listen to <code>entryWatcher.on(&#x27;update&#x27;)</code> to be notified when the value of node has changed.</p>
</blockquote>
<p>Call <code>await watcher.close()</code> to stop the watcher.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.watch"><strong><code>const watcher = db.watch([range])</code></strong><a href="#db.watch" class="hash-link" aria-label="Direct link to db.watch" title="Direct link to db.watch" translate="no">​</a></h4>
<p>Listens to changes that are on the optional <code>range</code>.</p>
<p><code>range</code> options are the same as <code>createReadStream</code> except they are reversed.</p>
<blockquote>
<p>By default, the yielded snapshots will have the bee&#x27;s key encoding and value encoding, but can be overwritten by setting the <code>keyEncoding</code> and <code>valueEncoding</code> options.</p>
</blockquote>
<p>Usage example:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> previous</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> watcher</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">previous</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Returns a new value after a change, <code>current</code> and <code>previous</code> are snapshots that are auto-closed before the next value.</p>
<p>Methods:</p>
<p><code>await watcher.ready()</code></p>
<p>Waits until the watcher is loaded and detects changes.</p>
<p><code>await watcher.destroy()</code></p>
<p>Stops the watcher. Using <code>break</code> inside the <code>for await</code> loop will also destroy the watcher.</p>
<blockquote>
<p>Do not attempt to manually close the snapshots. Since they&#x27;re used internally, let them be auto-closed.</p>
</blockquote>
<blockquote>
<p>Watchers are not supported on subs and checkouts. Instead, use the <code>range</code> option to limit the scope.</p>
</blockquote>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.checkout"><strong><code>const snapshot = db.checkout(version)</code></strong><a href="#db.checkout" class="hash-link" aria-label="Direct link to db.checkout" title="Direct link to db.checkout" translate="no">​</a></h4>
<p>Get a read-only snapshot of a previous version.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.snapshot"><strong><code>const snapshot = db.snapshot()</code></strong><a href="#db.snapshot" class="hash-link" aria-label="Direct link to db.snapshot" title="Direct link to db.snapshot" translate="no">​</a></h4>
<p>Shorthand for getting a checkout for the current version.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.sub"><strong><code>const sub = db.sub(&#x27;sub-prefix&#x27;, options = {})</code></strong><a href="#db.sub" class="hash-link" aria-label="Direct link to db.sub" title="Direct link to db.sub" translate="no">​</a></h4>
<p>Create a sub-database where a given value will prefix all entries.</p>
<p>This makes it easy to create namespaces within a single Hyperbee.</p>
<p><code>options</code> include:</p>
<table><thead><tr><th style="text-align:center">Property</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody><tr><td style="text-align:center"><strong><code>sep</code></strong></td><td>A namespace separator</td><td>Buffer</td><td><code>Buffer.alloc(1)</code></td></tr><tr><td style="text-align:center"><strong><code>valueEncoding</code></strong></td><td>Encoding type for the values. Takes values of &#x27;json&#x27;, &#x27;utf-8&#x27;, or &#x27;binary&#x27;.</td><td>String</td><td><code>defaults to the parents</code></td></tr><tr><td style="text-align:center"><strong><code>keyEncoding</code></strong></td><td>Encoding type for the keys. Takes values of &#x27;ascii&#x27;, &#x27;utf-8&#x27;, or &#x27;binary&#x27;.</td><td>String</td><td><code>defaults to the parents</code></td></tr></tbody></table>
<p>For example:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> root </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Hyperbee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;a&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// In root, this will have the key (&#x27;a&#x27; + separator + &#x27;b&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> sub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;b&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;hello&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Returns =&gt; { key: &#x27;b&#x27;, value: &#x27;hello&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> sub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;b&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.getheader"><strong><code>const header = await db.getHeader([options])</code></strong><a href="#db.getheader" class="hash-link" aria-label="Direct link to db.getheader" title="Direct link to db.getheader" translate="no">​</a></h4>
<p>Returns the header contained in the first block. Throws an error if undecodable.</p>
<p><code>options</code> are the same as the <code>core.get</code> method.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="db.ishyperbee"><strong><code>const isHyperbee = await Hyperbee.isHyperbee(core, [options])</code></strong><a href="#db.ishyperbee" class="hash-link" aria-label="Direct link to db.ishyperbee" title="Direct link to db.ishyperbee" translate="no">​</a></h4>
<p>Returns <code>true</code> if the core contains a Hyperbee, <code>false</code> otherwise.</p>
<p>This requests the first block on the core, so it can throw depending on the options.</p>
<p><code>options</code> are the same as the <code>core.get</code> method.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/references/building-blocks/hyperbee.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#api" class="table-of-contents__link toc-highlight">API</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"></div></footer></div>
</body>
</html>