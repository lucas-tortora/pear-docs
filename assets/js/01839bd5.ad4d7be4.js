"use strict";(globalThis.webpackChunkpear_docs_docusarus=globalThis.webpackChunkpear_docs_docusarus||[]).push([[2305],{8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>t});var i=r(6540);const s={},a=i.createContext(s);function o(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:n},e.children)}},9274:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"how-to/migrate-from-pear-v1-to-v2","title":"Migration","description":"Pear v2 introduces a breaking change to the application entrypoint and includes several API deprecations.","source":"@site/docs/how-to/migrate-from-pear-v1-to-v2.md","sourceDirName":"how-to","slug":"/how-to/migrate-from-pear-v1-to-v2","permalink":"/pear-docs/how-to/migrate-from-pear-v1-to-v2","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/how-to/migrate-from-pear-v1-to-v2.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Making a Bare Mobile Application","permalink":"/pear-docs/how-to/create-a-bare-mobile-app"},"next":{"title":"API","permalink":"/pear-docs/references/bare/api"}}');var s=r(4848),a=r(8453);const o={},t="Migration",c={},d=[{value:"Migration Scenarios",id:"migration-scenarios",level:2},{value:"Migration Strategy",id:"migration-strategy",level:2},{value:"Explanation",id:"explanation",level:3},{value:"Config Migration",id:"config-migration",level:2},{value:"Route-Handling Migration",id:"route-handling-migration",level:3},{value:"API Migration",id:"api-migration",level:2},{value:"<code>Pear</code> -&gt; <code>ui</code>",id:"pear---ui",level:3},{value:"<code>Pear</code> -&gt; <code>pear-*</code>",id:"pear---pear-",level:3},{value:"<code>Pear</code>",id:"pear",level:3},{value:"Verifying Migration",id:"verifying-migration",level:2},{value:"Compat Mode",id:"compat-mode",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"migration",children:"Migration"})}),"\n",(0,s.jsx)(n.p,{children:"Pear v2 introduces a breaking change to the application entrypoint and includes several API deprecations."}),"\n",(0,s.jsx)(n.p,{children:"Pear v1 supports HTML entrypoints, while Pear v2 supports only JavaScript entrypoints."}),"\n",(0,s.jsx)(n.h2,{id:"migration-scenarios",children:"Migration Scenarios"}),"\n",(0,s.jsx)(n.p,{children:"There are two migratory scenarios:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Pre-transitional Migration: a Pear v1 application, preparing to migrate to Pear v2 prior to Pear v2 release"}),"\n",(0,s.jsx)(n.li,{children:"Post-transitional Migration: a Pear v1 application updating to Pear v2 after Pear v2 release has occurred"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"In both cases the Migration Strategy will work."}),"\n",(0,s.jsx)(n.h2,{id:"migration-strategy",children:"Migration Strategy"}),"\n",(0,s.jsx)(n.p,{children:"To prepare a Pear Desktop Application written for Pear v1 to seamlessly migrate to v2 prior to v2 release use the following strategy:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Ensure the project ",(0,s.jsx)(n.code,{children:"package.json"})," ",(0,s.jsx)(n.code,{children:"main"})," field is ",(0,s.jsx)(n.strong,{children:"unset"})," and ensure that the HTML entry file is named ",(0,s.jsx)(n.code,{children:"index.html"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Install dependencies: ",(0,s.jsx)(n.code,{children:"npm install pear-electron pear-bridge"})]}),"\n",(0,s.jsxs)(n.li,{children:["Set ",(0,s.jsx)(n.code,{children:"package.json"})," ",(0,s.jsx)(n.code,{children:"pear.pre"})," field to ",(0,s.jsx)(n.code,{children:"pear-electron/pre"})]}),"\n",(0,s.jsxs)(n.li,{children:["Add an ",(0,s.jsx)(n.code,{children:"index.js"})," file that uses ",(0,s.jsx)(n.code,{children:"pear-electron"})," and ",(0,s.jsx)(n.code,{children:"pear-bridge"}),":"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import Runtime from 'pear-electron'\nimport Bridge from 'pear-bridge'\n\nconst bridge = new Bridge()\nawait bridge.ready()\n\nconst runtime = new Runtime()\nconst pipe = await runtime.start({ bridge })\npipe.on('close', () => Pear.exit())\n"})}),"\n",(0,s.jsx)(n.p,{children:"Install the dependencies:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npm install pear-electron pear-bridge\n"})}),"\n",(0,s.jsx)(n.h3,{id:"explanation",children:"Explanation"}),"\n",(0,s.jsx)(n.p,{children:"List numbers correspond as explanations for items in Pear v1 to Pear v2 Pre-transitional Migration Strategy."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["v1 supports ",(0,s.jsx)(n.code,{children:".html"})," ",(0,s.jsx)(n.code,{children:"main"})," fields, v2 only supports ",(0,s.jsx)(n.code,{children:".js"})," fields. This approach relies on ",(0,s.jsx)(n.code,{children:"index.html"})," (v1) and ",(0,s.jsx)(n.code,{children:"index.js"})," (v2) ",(0,s.jsx)(n.code,{children:"main"})," field defaults so that when the update occurs from v1 to v2 there's no validation issue on the ",(0,s.jsx)(n.code,{children:"main"})," field and the entrypoint exists whichever version of Pear the app is running on."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pear-electron"})," is the UI library for v2, ",(0,s.jsx)(n.code,{children:"pear-bridge"})," provides http-p2p functionality for electron, installing them into a v1 application makes it v2 ready prior to v2 release."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pear.pre"})," is a v2 feature that runs pre-run (from disk) and pre-stage. ",(0,s.jsx)(n.code,{children:"pear-electron/pre"})," is a script that autosets ",(0,s.jsx)(n.code,{children:"pear.assets.ui"})," and ",(0,s.jsx)(n.code,{children:"pear.stage.entrypoints"})," (for html script tag entrypoint warmups)"]}),"\n",(0,s.jsxs)(n.li,{children:["v2 applications only run ",(0,s.jsx)(n.code,{children:".js"})," files. The ",(0,s.jsx)(n.code,{children:"index.js"})," file starts desktop application code in electron UI."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"config-migration",children:"Config Migration"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"package.json"})," ",(0,s.jsx)(n.code,{children:"pear"})," field supplies configuration information for Pear applications."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pear.userAgent"})," -> ",(0,s.jsx)(n.code,{children:"pear.gui.userAgent"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pear.gui.hideable"})," -> ",(0,s.jsx)(n.code,{children:"pear.gui.closeHides"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"When preparing for v2 in advance, both fields must be present:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"pear": {\n  "userAgent": "custom user agent",\n  "gui": {\n    "userAgent": "custom user agent",\n    "hideable": true,\n    "closesHides": true\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"route-handling-migration",children:"Route-Handling Migration"}),"\n",(0,s.jsx)(n.p,{children:"If applications are performing route handling, in v2 it is necessary for an application to opt-in to routing."}),"\n",(0,s.jsxs)(n.p,{children:["In v1 when a ",(0,s.jsx)(n.code,{children:"pear://"})," link is clicked outside of the application (e.g. in another app), or supplied to ",(0,s.jsx)(n.code,{children:"pear run"})," the application is either opened, or sent a wakeup notification if already open."]}),"\n",(0,s.jsxs)(n.p,{children:["When the application is opened, ",(0,s.jsx)(n.code,{children:"Pear.config.linkData"})," contains the pathname of the ",(0,s.jsx)(n.code,{children:"pear://"})," link, excluding the leading ",(0,s.jsx)(n.code,{children:"/"}),". For example pear://runtime/pathname/to/some/where ",(0,s.jsx)(n.code,{children:"linkData"})," would be ",(0,s.jsx)(n.code,{children:"pathname/to/some/where"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["When woken, ",(0,s.jsx)(n.code,{children:"Pear.updates((wakeup) => {})"})," provides ",(0,s.jsx)(n.code,{children:"wakeup.linkData"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["In v2 ",(0,s.jsx)(n.code,{children:"linkData"})," is still available in both cases, but soft-deprecated in favor of v2 routing:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.app.entrypoint"})," & ",(0,s.jsx)(n.code,{children:"wakeup.entrypoint"})," - full pathname: pear://runtime/pathname/to/some/where -> ",(0,s.jsx)(n.code,{children:"/pathname/to/some/where"}),". The ",(0,s.jsx)(n.code,{children:"entrypoint"})," is mapped per ",(0,s.jsx)(n.code,{children:"pear.routes"})," configuration."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.app.fragment"})," & ",(0,s.jsx)(n.code,{children:"wakeup.fragment"})," - location hash without ",(0,s.jsx)(n.code,{children:"#"}),": pear://runtime/pathname#something -> ",(0,s.jsx)(n.code,{children:"something"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.app.query"})," & ",(0,s.jsx)(n.code,{children:"wakeup.query"})," - query string without ",(0,s.jsx)(n.code,{children:"?"}),". pear://runtime/pathname?some-query -> ",(0,s.jsx)(n.code,{children:"some-query"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["To opt-in fully to v1 behavior the catch-all ",(0,s.jsx)(n.code,{children:"routes"})," config can be used:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "pear": {\n    "routes": "."\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"api-migration",children:"API Migration"}),"\n",(0,s.jsxs)(n.p,{children:["The Pear v2 API deprecates all UI related methods now exported from ",(0,s.jsx)(n.code,{children:"pear-electron"})," and a few others that have been moved to modules or renamed."]}),"\n",(0,s.jsxs)(n.h3,{id:"pear---ui",children:[(0,s.jsx)(n.code,{children:"Pear"})," -> ",(0,s.jsx)(n.code,{children:"ui"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import ui from 'pear-electron'\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.media"})," -> ",(0,s.jsx)(n.code,{children:"ui.media"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.tray"})," -> ",(0,s.jsx)(n.code,{children:"ui.app.tray"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.badge"})," -> ",(0,s.jsx)(n.code,{children:"ui.app.badge"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.Window"})," -> ",(0,s.jsx)(n.code,{children:"ui.Window"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.View"})," -> ",(0,s.jsx)(n.code,{children:"ui.View"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.Window.self"})," / ",(0,s.jsx)(n.code,{children:"Pear.View.self"})," -> ",(0,s.jsx)(n.code,{children:"ui.app"})]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"pear---pear-",children:[(0,s.jsx)(n.code,{children:"Pear"})," -> ",(0,s.jsx)(n.code,{children:"pear-*"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.worker.run"})," -> ",(0,s.jsx)(n.a,{href:"https://github.com/holepunchto/pear-run",children:(0,s.jsx)(n.code,{children:"pear-run"})})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.worker.pipe"})," -> ",(0,s.jsx)(n.a,{href:"https://github.com/holepunchto/pear-pipe",children:(0,s.jsx)(n.code,{children:"pear-pipe"})})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.message"})," -> ",(0,s.jsx)(n.a,{href:"https://github.com/holepunchto/pear-message",children:(0,s.jsx)(n.code,{children:"pear-message"})})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.messages"})," -> ",(0,s.jsx)(n.a,{href:"https://github.com/holepunchto/pear-messages",children:(0,s.jsx)(n.code,{children:"pear-messages"})})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.wakeups"})," -> ",(0,s.jsx)(n.a,{href:"https://github.com/holepunchto/pear-wakeups",children:(0,s.jsx)(n.code,{children:"pear-wakeups"})})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.updates"})," -> ",(0,s.jsx)(n.a,{href:"https://github.com/holepunchto/pear-updates",children:(0,s.jsx)(n.code,{children:"pear-updates"})})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"pear",children:(0,s.jsx)(n.code,{children:"Pear"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.config"})," -> ",(0,s.jsx)(n.code,{children:"Pear.app"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pear.reload"})," -> ",(0,s.jsx)(n.code,{children:"location.reload"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"verifying-migration",children:"Verifying Migration"}),"\n",(0,s.jsx)(n.p,{children:"Verify in development with"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"pear run -d .\n"})}),"\n",(0,s.jsx)(n.p,{children:"Production equivalent verification:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"pear stage check\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then per link output from stage command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"pear run <link>\n"})}),"\n",(0,s.jsx)(n.p,{children:"If the application starts and operates correctly in any related areas where changes have been made, then migration is verified."}),"\n",(0,s.jsxs)(n.p,{children:["If the SemVer printed by ",(0,s.jsx)(n.code,{children:"pear -v"})," is 2.x.x then migration verification is complete."]}),"\n",(0,s.jsxs)(n.p,{children:["If the SemVer printed by ",(0,s.jsx)(n.code,{children:"pear -v"})," is 1.x.x then these steps need to performed on v2 also."]}),"\n",(0,s.jsx)(n.p,{children:"Switch to v2 with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"pear sidecar --key dhpc5npmqkansx38uh18h3uwpdp6g9ukozrqyc4irbhwriedyeho\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will run the current sidecar in the terminal and switch to the v2 release line per the supplied key."}),"\n",(0,s.jsx)(n.p,{children:"The command should output something similar to:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:'- Closing any current Sidecar clients...\n- Shutting down current Sidecar...\n\u2714 Sidecar has shutdown\n- Rebooting current process as Sidecar\n  - [ pqbzjhqyonxprx8hghxexnmctw75mr91ewqw5dxe1zmntfyaddqy ]\n- Runtime: pear-runtime\n\n========================= INIT ===================================\n\n- Sidecar Booting [+0ms]\n\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\u2714 Current process is now Sidecar\n- Version: {\n    "key": "pqbzjhqyonxprx8hghxexnmctw75mr91ewqw5dxe1zmntfyaddqy",\n    "length": 9195,\n    "fork": 0\n  }\n\n========================= RUN ====================================\n\n- Switching to key dhpc5npmqkansx38uh18h3uwpdp6g9ukozrqyc4irbhwriedyeho with length 3097... [+261.4711ms]\nPlatform update Available. Restart to update to: [+367.2348ms]\n v0.3097.dhpc5npmqkansx38uh18h3uwpdp6g9ukozrqyc4irbhwriedyeho [+0.0349ms]\n- DHT known-nodes read from database 100 nodes [+4631.6207ms]\n- Drive bundle dhpc5npmqkansx38uh18h3uwpdp6g9ukozrqyc4irbhwriedyeho core length: 3097 [+5.1877ms]\n- Sidecar swarm joining discovery key of dhpc5npmqkansx38uh18h3uwpdp6g9ukozrqyc4irbhwriedyeho [+0.0797ms]\n- Sidecar Booted [+1.1023ms]\n'})}),"\n",(0,s.jsxs)(n.p,{children:['Once the "Restart to update" message is observed, use ctrl+c to close the sidecar and then run ',(0,s.jsx)(n.code,{children:"pear -v"})," to verify that the key is correct. If it isn't, try again. If it is, verify the application on v2."]}),"\n",(0,s.jsx)(n.p,{children:"Verify in development with"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"pear run -d .\n"})}),"\n",(0,s.jsx)(n.p,{children:"Production equivalent verification:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"pear stage check\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then per link output from stage command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"pear run -d <link>\n"})}),"\n",(0,s.jsx)(n.p,{children:"If the application starts and operates correctly, then migration is verified."}),"\n",(0,s.jsx)(n.p,{children:"Once verified, switch back to production:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"pear sidecar --key pqbzjhqyonxprx8hghxexnmctw75mr91ewqw5dxe1zmntfyaddqy\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If there's any problems switching back, make sure there are no ",(0,s.jsx)(n.code,{children:"pear-runtime"})," processes running and run ",(0,s.jsx)(n.code,{children:"npx pear"}),"."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,s.jsx)(n.strong,{children:"WARNING:"})," Omitting to switch back to production Pear leaves the system on a release-line that will be ended."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"In order to avoid any issues, be sure to switch back to production [ pqbzjhqyonx... ]"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"compat-mode",children:"Compat Mode"}),"\n",(0,s.jsx)(n.p,{children:"While v1 Pear APIs will continue to function with deprecation messages, for projects that need a legacy-bridge during overlapping transitional periods, compat-mode can be used to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Silence deprecation warnings"}),"\n",(0,s.jsx)(n.li,{children:"Ensure legacy methods to continue to function after their removal for a longer time period"}),"\n",(0,s.jsx)(n.li,{children:"Limit ability to use new APIs in future"}),"\n",(0,s.jsx)(n.li,{children:"Eventually itself be deprecated & removed"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Compat mode is a temporary transitioning utility, if usage can be avoided in favour of moving to the equivalent methods this avoids potential for legacy lock-in."}),"\n",(0,s.jsxs)(n.p,{children:["Enable with ",(0,s.jsx)(n.code,{children:"<script>Pear.constructor.COMPAT = true<\/script>"})," at the top of the ",(0,s.jsx)(n.code,{children:"<head>"})," element in the HTML entrypoint and ",(0,s.jsx)(n.code,{children:"Pear.constructor.COMPAT = true"})," at the top of worker or terminal app entrypoints."]}),"\n",(0,s.jsx)(n.p,{children:"Compat mode isn't needed for premigration, only if time is needed for the application to transition to equivalent v2 APIs."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);